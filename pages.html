<h1 id="pages">Pages</h1>
<p>A page is an HTML file with template tags. The template language allows you to request data, include pages, evaluate expressions, set and render variables. To render a page you need a matching <a href="/docs/routes">route</a> to point to the page.</p>
<p>Template tags are wrapped with two curly braces starting with <code>{{</code> and ending with <code>}}</code>.</p>
<p>When you want to evaluate a variable inside a tag, use either a colon at the start <code>:myVariable</code>, or wrap the variable in a dollar sign and two parenthesis <code>$(myVariable)</code>. Some tags will automatically evaluate the variable like <code>if</code> and <code>set</code> or when documented as <code>&lt;variable&gt;</code>.</p>
<h2 id="tags">Tags</h2>
<h3 id="get-url-role-as-variable">{{ get &lt;url&gt; [&lt;role&gt;] as &lt;variable&gt; }}</h3>
<ul>
<li><code>url</code>: URL to retrieve data from the database.</li>
<li><code>role</code>: Role of the user to make the GET request as (optional).</li>
<li><code>variable</code>: Save the data in the variable provided.</li>
</ul>
<p>Retrieve data from the database through the <a href="/docs/rest#GET">HTTP interface</a>. The result is placed in the variable you provide after <code>as</code>.</p>
<p>You may optionally provide a <a href="/docs/permissions#user-types">user type</a> to make the request as a different role if the logged in user would otherwise not be able to complete.</p>
<p><em>Note: This will not work for every URL, only paths to the <a href="/docs/rest">HTTP interface</a>.</em></p>
<pre><code>{{ get /data/articles/ as articles }}
{{ each articles as article }}
    &lt;h1&gt;{{article.title}}&lt;/h1&gt;
    {{article.body}}
{{ /each }}</code></pre>
<h3 id="post-url-data-role-as-variable">{{ post &lt;url&gt; &lt;data&gt; [&lt;role&gt;] as &lt;variable&gt; }}</h3>
<ul>
<li><code>url</code>: URL to store data in the database.</li>
<li><code>data</code>: Name of the object variable with the data to store.</li>
<li><code>role</code>: Role of the user to make the GET request as (optional).</li>
<li><code>variable</code>: Save the response in the variable provided.</li>
</ul>
<p>Store data in the database through the <a href="/docs/rest#POST">HTTP interface</a>. The result is placed in the variable you provide after <code>as</code>.</p>
<p>With this tag you may modify data that the logged in user would otherwise not have permission to complete by manually entering a <a href="/docs/permissions#user-types">user type</a>. This is useful for creating pages that require special logic or processing before storing the data.</p>
<p><em>Note: This will not work for every URL, only paths to the <a href="/docs/rest">HTTP interface</a>.</em></p>
<pre><code>{{ set data.title Hello }}
{{ set data.body Goodbye }}
{{ post /data/articles/ data admin as articles }}</code></pre>
<h3 id="each-collection-as-variable">{{ each &lt;collection&gt; as &lt;variable&gt; }}</h3>
<ul>
<li><code>collection</code>: List of data to iterate through.</li>
<li><code>variable</code>: Name of the variable containing each item.</li>
</ul>
<p>Iterate over a list of data. Usually you will use this with the <code>get</code> tag which will retrieve the data as a list. Everything inside the <code>each</code> block will be repeated for each of the elements in the collection.</p>
<h3 id="if-variable-operator-value">{{ if &lt;variable&gt; &lt;operator&gt; &lt;value&gt; }}</h3>
<ul>
<li><code>variable</code>: Variable to test.</li>
<li><code>operator</code>: Operator for expression. See list below.</li>
<li><code>value</code>: Value to test.</li>
</ul>
<p>Use this tag to only evaluate nested tags and HTML based on an expression.</p>
<p>Available operators:</p>
<ul>
<li><code>eq</code>, <code>=</code>: Variable <strong>equals</strong> value.</li>
<li><code>gt</code>, <code>&gt;</code>: Variable is <strong>greater</strong> than value.</li>
<li><code>lt</code>, <code>&lt;</code>: Variable is <strong>less</strong> than value.</li>
<li><code>gte</code>, <code>&gt;=</code>: Variable is <strong>greater than or equal</strong> to value.</li>
<li><code>lte</code>, <code>&lt;=</code>: Variable is <strong>less than or equal</strong> to value.</li>
<li><code>neq</code>, <code>!=</code>: Variable is <strong>not equal</strong> to value.</li>
</ul>
<pre><code>{{ if articles.length gt 0 }}
    &lt;p&gt;List of articles&lt;/p&gt;
{{ /if }}</code></pre>
<h3 id="unless-variable-operator-value">{{ unless &lt;variable&gt; &lt;operator&gt; &lt;value&gt; }}</h3>
<p>Same as <code>if</code> but negated.</p>
<h3 id="else">{{ else }}</h3>
<p>Use this tag in conjuction with <code>if</code>. If the expression is not true, tags nested in the else will be evaluated instead.</p>
<pre><code>{{ if articles.length gt 0 }}
    &lt;p&gt;List of articles&lt;/p&gt;
{{ else }}
    &lt;p&gt;No articles found!&lt;/p&gt;
{{ /if }}</code></pre>
<h3 id="set-variable-value">{{ set &lt;variable&gt; &lt;value&gt; }}</h3>
<ul>
<li><code>variable</code>: Variable to set a value.</li>
<li><code>value</code>: Value to set the variable to.</li>
</ul>
<p>Set a variable to a value. If the variable contains a dot <code>.</code> the name before the dot will be turned into an object with whatever property comes after the dot. If the property name needs to contain a dot, you can wrap the name in double-quotes.</p>
<pre><code>{{ set pageTitle This is the title of my website }}
&lt;title&gt;{{pageTitle}}&lt;/title&gt;

{{ set obj.property 1 }}
{{ set obj.a.very.deep.property 2 }}
{{ set obj.&quot;property.with.dot&quot; 3 }}
{{ debug obj }}</code></pre>
<h3 id="expr-variable-expr">{{ expr &lt;variable&gt; &lt;expr&gt; }}</h3>
<ul>
<li><code>variable</code>: Variable to store the result of the expression.</li>
<li><code>expr</code>: Mathematical expression.</li>
</ul>
<p>This is a slightly advanced function to perform calculations. The result of the expression is stored in the variable provided.</p>
<p>See the <a href="http://mathjs.org">MathJS</a> docs for more information about available operators and Math functions.</p>
<pre><code>{{ expr score :article.thumbsUp - :article.thumbsDown }}
{{ score }}</code></pre>
<h3 id="date-date-format">{{ date &lt;date&gt; &lt;format&gt; }}</h3>
<ul>
<li><code>date</code>: The date to format in UNIX timestamp form.</li>
<li><code>format</code>: A special string to format a date</li>
</ul>
<p>Uses the <a href="http://momentjs.com/docs/#/displaying/format/">Moment</a> library to take a UNIX timestamp and format it. Every row in a model has a <code>_created</code> field that can be formatted.</p>
<pre><code>{{ each rows as row }}
    {{ date :row._created h:mma }}
{{ / }}</code></pre>
<h3 id="ago-date">{{ ago &lt;date&gt; }}</h3>
<ul>
<li><code>date</code>: The date as a UNIX timestamp.</li>
</ul>
<p>Returns a text representation of the time elapsed from now. Read more in the <a href="http://momentjs.com/docs/#/displaying/fromnow/">Moment docs</a>.</p>
<pre><code>{{ ago :row._created }}</code></pre>
<h3 id="include-file">{{ include &lt;file&gt; }}</h3>
<ul>
<li><code>file</code>: Include a text-file into the page.</li>
</ul>
<p>Include and evaluate another page. Can also be plain HTML. Will only search in the current directory.</p>
<p><code>{{ #include }}</code> will do the same but will not evaluate the template tags.</p>
<pre><code>{{ include header.sprt }}
&lt;p&gt;Body content&lt;/p&gt;
{{ include footer.sprt }}</code></pre>
<h3 id="variable">{{ &lt;variable&gt; }}</h3>
<p>Will replace the tag with the variable contents in the HTML rendered. By default the value will replace all HTML with HTML entities (<code>&lt;</code> is replaced with <code>&amp;lt;</code>). This is for security reasons to prevent XSS where users can inject JavaScript into your webpage.</p>
<p><code>{{ #&lt;variable&gt; }}</code> will do the same but will not escape the HTML. This should only be used if the data is trusted, such as if an administrator created it.</p>
<pre><code>&lt;p&gt;{{myVar}}&lt;/p&gt;</code></pre>
<h3 id="section">{{ / }}</h3>
<p>Required to close open tags such as <code>if</code> and <code>each</code>. You may put any text after the backslash to help remember which tag it's closing.</p>
<pre><code>{{ if someExpression }}

{{ /I can be anything }}</code></pre>
<h3 id="redirect-url">{{ redirect &lt;url&gt; }}</h3>
<ul>
<li><code>url</code>: Path to redirect to.</li>
</ul>
<p>Will stop all processing of the page and redirect the user to the path specified.</p>
<pre><code>{{ unless session.user }}
    {{ redirect /login }}
{{ / }}</code></pre>
<h3 id="debug-variable">{{ debug &lt;variable&gt; }}</h3>
<ul>
<li><code>variable</code>: Variable to print.</li>
</ul>
<p>Print all the properties and values on a variable. Runs <code>JSON.stringify</code> on the provided variable and wraps it in <code>&lt;pre&gt;</code> tags.</p>
<pre><code>{{ debug self }}</code></pre>
<h3 id="error-message">{{ error &lt;message&gt; }}</h3>
<ul>
<li><code>message</code>: Error message to display.</li>
</ul>
<p>Stop processing the page and respond to the user with a <code>500</code> code and a JSON string of the error. You can render a page instead of a JSON string by changing the Error View to an error page in Config.</p>
<pre><code>{{ error Page could not be displayed }}</code></pre>
<h3 id="json-variable">{{ json &lt;variable&gt; }}</h3>
<ul>
<li><code>variable</code>: Variable to respond as JSON.</li>
</ul>
<p>Stop processing the page and respond to the user with a JSON string of the variable passed. Will serve with Content-Type <code>application/json</code>.</p>
<pre><code>{{ set myobj.x 1 }}
{{ set myobj.y 2 }}
{{ set myobj.z 3 }}
{{ json myobj }}</code></pre>
<h3 id="escaping-the-tag">Escaping the tag</h3>
<p>If you actually want two curly braces in your page without it being a tag, you can use an HTML entity (<code>&amp;amp;#123;</code>) or put a forwardslash before the tag <code>\{{</code>.</p>
<h2 id="global-variables">Global Variables</h2>
<p>When rendering a page, you have access to a variety of variables.</p>
<h3 id="params">params</h3>
<p>This object contains the placeholders specified from the <a href="/docs/routes">routes</a>.</p>
<h3 id="query">query</h3>
<p>URLs can have query variables (e.g. <code>?queryOption=hi</code>). You can access this through the <code>query</code> object.</p>
<pre><code>{{ query.name }}</code></pre>
<p><em>Alias: <code>$_GET</code></em></p>
<h3 id="form">form</h3>
<p>Pages can have data posted to it. This post data is found under the <code>form</code> object.</p>
<pre><code>{{ if form }}
    {{ debug form }}
{{ / }}</code></pre>
<p><em>Alias: <code>$_POST</code></em></p>
<h3 id="headers">headers</h3>
<p>All the request headers sent to the page in lower-case.</p>
<pre><code>{{ if headers.referer }}
    {{ redirect :headers.referer }}
{{ / }}</code></pre>
<h3 id="session">session</h3>
<p>The built-in user accounts are attached to the session object. You will mainly be using the user account at <code>session.user</code>. This contains the entire logged in user object. If the user is not logged-in this value will be empty.</p>
<h3 id="self">self</h3>
<p>Assorted variables are contained in the <code>self</code> object.</p>
<ul>
<li><code>url</code>: The requested URL being rendered.</li>
<li><code>dir</code>: Directory of the page being rendered.</li>
<li><code>name</code>: Name of the space.</li>
<li><code>method</code>: HTTP method making the request.</li>
</ul>
